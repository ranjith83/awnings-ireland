<!-- dashboard.component.html -->
<div class="dashboard-container">
  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <div class="header">
      <div>
        <div class="breadcrumb">OVERVIEW</div>
        <h1 class="page-title">Dashboard</h1>
      </div>
      <button class="create-report-btn">Create Report</button>
    </div>

    <!-- Error Banner -->
    <div class="error-banner" *ngIf="errorMessage$ | async as errorMessage">
      <div class="error-content">
        <span>{{ errorMessage }}</span>
      </div>
      <button class="btn-retry" (click)="retryLoad()">Retry</button>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="isLoading$ | async">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>

    <!-- Dashboard Content -->
    <ng-container *ngIf="(isLoading$ | async) === false">
      <!-- Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card" *ngIf="stats$ | async as stats">
          <div class="stat-content">
            <div class="stat-label">Orders to Date</div>
            <div class="stat-value-row">
              <div class="stat-value">{{ stats.ordersToDate.value }}</div>
              <span 
                class="stat-badge" 
                [class.positive]="stats.ordersToDate.positive"
                [class.negative]="!stats.ordersToDate.positive">
                {{ stats.ordersToDate.change }}
              </span>
            </div>
          </div>
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
              </path>
            </svg>
          </div>
        </div>

        <div class="stat-card" *ngIf="stats$ | async as stats">
          <div class="stat-content">
            <div class="stat-label">Orders In Progress</div>
            <div class="stat-value-row">
              <div class="stat-value">{{ stats.ordersInProgress.value }}</div>
              <span 
                class="stat-badge warning"
                [class.positive]="stats.ordersInProgress.positive"
                [class.negative]="!stats.ordersInProgress.positive">
                {{ stats.ordersInProgress.change }}
              </span>
            </div>
          </div>
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
              </path>
            </svg>
          </div>
        </div>

        <div class="stat-card" *ngIf="stats$ | async as stats">
          <div class="stat-content">
            <div class="stat-label">Orders Near Completion</div>
            <div class="stat-value-row">
              <div class="stat-value">{{ stats.ordersNearCompletion.value }}</div>
              <span 
                class="stat-badge"
                [class.positive]="stats.ordersNearCompletion.positive"
                [class.negative]="!stats.ordersNearCompletion.positive">
                {{ stats.ordersNearCompletion.change }}
              </span>
            </div>
          </div>
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
              </path>
            </svg>
          </div>
        </div>

        <div class="stat-card" *ngIf="stats$ | async as stats">
          <div class="stat-content">
            <div class="stat-label">Total Revenue</div>
            <div class="stat-value-row">
              <div class="stat-value">€{{ stats.totalRevenue.value | number:'1.0-0' }}</div>
              <span 
                class="stat-badge"
                [class.positive]="stats.totalRevenue.positive"
                [class.negative]="!stats.totalRevenue.positive">
                {{ stats.totalRevenue.change }}
              </span>
            </div>
          </div>
          <div class="stat-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
              </path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="chart-section">
        <div class="chart-header">
          <h2 class="chart-title">Sales Overview</h2>
          <div class="chart-tabs">
            <div 
              class="chart-tab" 
              [class.active]="activeTab === 'today'"
              (click)="switchTab('today')">
              Today
            </div>
            <div 
              class="chart-tab" 
              [class.active]="activeTab === 'month'"
              (click)="switchTab('month')">
              Month
            </div>
            <div 
              class="chart-tab" 
              [class.active]="activeTab === 'year'"
              (click)="switchTab('year')">
              Year
            </div>
          </div>
        </div>
        <div class="chart-container">
          <canvas #salesChart></canvas>
        </div>
      </div>

      <!-- Dashboard Grid -->
      <div class="dashboard-grid">
        <!-- Recent Orders -->
        <div class="card">
          <h3 class="card-title">Recent Orders</h3>
          <div class="order-list">
            <div 
              class="order-item"
              *ngFor="let order of recentOrders$ | async; trackBy: trackByOrderId">
              <div class="order-content">
                <p class="order-customer">{{ order.customerName }}</p>
                <p class="order-number">{{ order.orderNumber }}</p>
              </div>
              <div class="order-meta">
                <span 
                  class="badge" 
                  [ngClass]="getStatusBadgeClass(order.status)">
                  {{ order.status }}
                </span>
                <span class="order-amount">€{{ order.amount | number:'1.2-2' }}</span>
              </div>
            </div>
            <div *ngIf="(recentOrders$ | async)?.length === 0" class="no-data">
              No recent orders
            </div>
          </div>
        </div>

        <!-- Top Customers -->
        <div class="card">
          <h3 class="card-title">Top Customers</h3>
          <div class="customer-list">
            <div 
              class="customer-item"
              *ngFor="let customer of topCustomers$ | async; trackBy: trackByCustomerId">
              <div class="customer-content">
                <p class="customer-name">{{ customer.name }}</p>
                <p class="customer-orders">{{ customer.orders }} orders</p>
              </div>
              <div class="customer-revenue">
                €{{ customer.revenue | number:'1.2-2' }}
              </div>
            </div>
            <div *ngIf="(topCustomers$ | async)?.length === 0" class="no-data">
              No customer data
            </div>
          </div>
        </div>

        <!-- Status Distribution -->
        <div class="card">
          <h3 class="card-title">Order Status Distribution</h3>
          <div class="status-list">
            <div 
              class="status-item"
              *ngFor="let item of statusDistribution$ | async; trackBy: trackByStatus">
              <div class="status-header">
                <span class="status-name">{{ item.status }}</span>
                <span class="status-count">{{ item.count }}</span>
              </div>
              <div class="progress-bar">
                <div 
                  class="progress-fill"
                  [style.width.%]="item.percentage">
                </div>
              </div>
            </div>
            <div *ngIf="(statusDistribution$ | async)?.length === 0" class="no-data">
              No status data
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="card">
          <h3 class="card-title">Recent Activity</h3>
          <div class="activity-list">
            <div 
              class="activity-item"
              *ngFor="let activity of recentActivity$ | async; trackBy: trackByActivityId">
              <div class="activity-icon">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="10" stroke-width="2"></circle>
                </svg>
              </div>
              <div class="activity-content">
                <p class="activity-title">{{ activity.title }}</p>
                <p class="activity-description">{{ activity.description }}</p>
              </div>
              <div class="activity-time">
                {{ activity.time }}
              </div>
            </div>
            <div *ngIf="(recentActivity$ | async)?.length === 0" class="no-data">
              No recent activity
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </main>
</div>