<div class="create-quote-container">
  <!-- Loading & Messages -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <div class="quote-content">
    <!-- Select Workflow -->
    <div class="form-section">
      <h3 class="section-title">Select Workflow</h3>
      <div class="form-row">
        <div class="form-group full-width">
          <select class="form-select" [(ngModel)]="selectedWorkflowId" (change)="onWorkflowChange()">
            <option [value]="null" disabled selected>Select Workflow</option>
            <option *ngFor="let workflow of workflows" [value]="workflow.workflowId">
              {{ workflow.workflowName || 'Workflow #' + workflow.workflowId }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Select Product -->
    <div class="form-section">
      <h3 class="section-title">Select Product</h3>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Select Supplier Type</label>
          <select class="form-select" [(ngModel)]="selectedSupplierId" (change)="onSupplierChange()">
            <option [value]="null" disabled selected>Select</option>
            <option *ngFor="let supplier of suppliers" [value]="supplier.supplierId">
              {{ supplier.supplierName }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Select Model</label>
          <select class="form-select" [(ngModel)]="selectedModelId" [disabled]="!selectedSupplierId">
            <option [value]="null" disabled selected>Select</option>
            <option *ngFor="let model of models" [value]="model.productId">
              {{ model.productName }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Widths in cm</label>
          <select class="form-select" [(ngModel)]="selectedWidthCm" (change)="onWidthChange()">
            <option [value]="null" disabled selected>Select</option>
            <option *ngFor="let width of availableWidths" [value]="width">
              {{ width }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Select Awning (Projection)</label>
          <select class="form-select" [(ngModel)]="selectedAwning" (change)="onAwningChange()">
            <option [value]="null" disabled selected>Select</option>
            <option *ngFor="let projection of availableProjections" [value]="projection">
              {{ projection }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Additional Addons -->
    <div class="form-section">
      <h3 class="section-title">Additional Addons</h3>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Brackets</label>
          <select class="form-select" [(ngModel)]="selectedBrackets" (change)="onBracketChange()">
            <option value="" disabled selected>Select</option>
            <option *ngFor="let bracket of brackets" [value]="bracket.bracketId">
              {{ bracket.description }} - â‚¬{{ bracket.price | number:'1.2-2' }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Arms</label>
          <select class="form-select" [(ngModel)]="selectedArms" (change)="onArmChange()">
            <option value="" disabled selected>Select</option>
            <option *ngFor="let arm of arms" [value]="arm.armId">
              {{ arm.description }} - â‚¬{{ arm.price | number:'1.2-2' }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Motor</label>
          <select class="form-select" [(ngModel)]="selectedMotor" (change)="onMotorChange()">
            <option value="" disabled selected>Select</option>
            <option *ngFor="let motor of motors" [value]="motor.motorId">
              {{ motor.description }} - â‚¬{{ motor.price | number:'1.2-2' }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Heater</label>
          <select class="form-select" [(ngModel)]="selectedHeater" (change)="onHeaterChange()">
            <option value="" disabled selected>Select</option>
            <option *ngFor="let heater of heaters" [value]="heater.heaterId">
              {{ heater.description }} - â‚¬{{ heater.price | number:'1.2-2' }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Installation Fee -->
    <div class="form-section">
      <h3 class="section-title">Installation Fee</h3>
      <div class="form-row installation-row">
        <div class="form-group small">
          <label class="form-label">Fee</label>
          <input type="number" class="form-input" [(ngModel)]="installationFee" placeholder="0.00">
        </div>
        <div class="vat-text">{{ vatRate }}% VAT</div>
      </div>
    </div>

    <!-- Quote Items Table -->
    <div class="table-section">
      <div class="table-header">
        <h3>Quote Items</h3>
        <button class="btn-add" (click)="addQuoteItem()">+ Add Item</button>
      </div>
      <table class="quote-table">
        <thead>
          <tr>
            <th>DESCRIPTION</th>
            <th>QUANTITY</th>
            <th>UNIT PRICE</th>
            <th>TAX</th>
            <th>AMOUNT EUR</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of quoteItems; let i = index; let even = even" [class.even-row]="even">
            <td>{{ item.description }}</td>
            <td>
              <input 
                type="number" 
                class="qty-input" 
                [(ngModel)]="item.quantity"
                (ngModelChange)="onQuantityChange(item)"
                min="1">
            </td>
            <td>{{ item.unitPrice | number:'1.2-2' }}</td>
            <td>{{ item.taxRate }}%</td>
            <td>{{ item.amount | number:'1.2-2' }}</td>
            <td>
              <button class="btn-remove" (click)="removeQuoteItem(i)" *ngIf="quoteItems.length > 1">
                Remove
              </button>
            </td>
          </tr>
          <tr *ngIf="quoteItems.length === 0">
            <td colspan="6" class="text-center">
              Select width and awning to generate first line item
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Summary Section -->
    <div class="summary-section">
      <div class="summary-left">
        <label class="checkbox-label large">
          <input type="checkbox" class="checkbox-input" [(ngModel)]="emailToCustomer">
          <span>Email Quote to customer</span>
        </label>
        <button class="attach-btn">Attach Brochure with email</button>
      </div>

      <div class="summary-right">
        <div class="summary-row">
          <span class="summary-label">Sub Total</span>
          <span class="summary-value">â‚¬{{ subtotal | number:'1.2-2' }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Total Sales TAX {{ vatRate }}%</span>
          <span class="summary-value">â‚¬{{ totalTax | number:'1.2-2' }}</span>
        </div>
        <div class="summary-row total">
          <span class="summary-label">Total EUR</span>
          <span class="summary-value">â‚¬{{ totalAmount | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn-close" (click)="close()">
        <span class="close-icon">âœ•</span>
        Close
      </button>
      <button class="btn-generate" (click)="generateQuote()" [disabled]="!isFormValid()">
        <span class="generate-icon">ðŸ“„</span>
        Generate Quote
      </button>
    </div>
  </div>
</div>